<!-- Views/Claims/ClaimDetails.cshtml -->
@model Claim

<h2>Claim Details</h2>
<hr />

<div class="row">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Claim Information</h5>
            </div>
            <div class="card-body">
                <dl class="row">
                    <dt class="col-sm-4">Lecturer:</dt>
                    <dd class="col-sm-8">@Model.Lecturer.FirstName @Model.Lecturer.LastName</dd>

                    <dt class="col-sm-4">Period:</dt>
                    <dd class="col-sm-8">@System.Globalization.CultureInfo.CurrentCulture.DateTimeFormat.GetMonthName(Model.Month) @Model.Year</dd>

                    <dt class="col-sm-4">Hours Worked:</dt>
                    <dd class="col-sm-8">@Model.HoursWorked</dd>

                    <dt class="col-sm-4">Hourly Rate:</dt>
                    <dd class="col-sm-8">@Model.HourlyRate.ToString("C")</dd>

                    <dt class="col-sm-4">Total Amount:</dt>
                    <dd class="col-sm-8"><strong>@Model.TotalAmount.ToString("C")</strong></dd>

                    <dt class="col-sm-4">Status:</dt>
                    <dd class="col-sm-8">
                        <span class="badge @GetStatusBadgeClass(Model.Status)">
                            @GetStatusDisplayText(Model.Status)
                        </span>
                    </dd>

                    <dt class="col-sm-4">Submitted:</dt>
                    <dd class="col-sm-8">@Model.SubmittedDate.ToString("dd MMM yyyy HH:mm")</dd>

                    @if (!string.IsNullOrEmpty(Model.Notes))
                    {
                        <dt class="col-sm-4">Notes:</dt>
                        <dd class="col-sm-8">@Model.Notes</dd>
                    }
                </dl>

                @if (!string.IsNullOrEmpty(Model.FileName))
                {
                    <div class="mt-3">
                        <a href="@Url.Action("DownloadDocument", new { id = Model.ClaimId })"
                           class="btn btn-outline-primary">
                            <i class="fas fa-download"></i> Download Supporting Document
                        </a>
                        <small class="text-muted d-block">@Model.FileName</small>
                    </div>
                }
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">Status History</h5>
            </div>
            <div class="card-body">
                @if (Model.StatusHistory.Any())
                {
                    <div class="timeline">
                        @foreach (var history in Model.StatusHistory.OrderBy(h => h.ActionDate))
                        {
                            <div class="timeline-item mb-3">
                                <div class="d-flex">
                                    <div class="timeline-marker bg-@GetStatusColor(history.Status)"></div>
                                    <div class="flex-grow-1">
                                        <h6 class="mb-1">@GetStatusDisplayText(history.Status)</h6>
                                        <p class="mb-1 text-muted">@history.Notes</p>
                                        <small class="text-muted">
                                            By @history.ActionBy on @history.ActionDate.ToString("dd MMM yyyy HH:mm")
                                        </small>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                }
                else
                {
                    <p class="text-muted">No status history available.</p>
                }
            </div>
        </div>
    </div>
</div>

<div class="mt-3">
    <a href="@Url.Action("MyClaims")" class="btn btn-secondary">Back to My Claims</a>
</div>

<style>
    .timeline {
        position: relative;
    }

    .timeline-item {
        position: relative;
        padding-left: 20px;
    }

    .timeline-marker {
        position: absolute;
        left: 0;
        top: 5px;
        width: 12px;
        height: 12px;
        border-radius: 50%;
    }

    .bg-warning {
        background-color: #ffc107;
    }

    .bg-info {
        background-color: #0dcaf0;
    }

    .bg-success {
        background-color: #198754;
    }

    .bg-danger {
        background-color: #dc3545;
    }
</style>

@functions {
    public string GetStatusBadgeClass(string status)
    {
        return status switch
        {
            "Pending" => "bg-warning",
            "ApprovedByCoordinator" => "bg-info",
            "Approved" => "bg-success",
            "Rejected" => "bg-danger",
            _ => "bg-secondary"
        };
    }

    public string GetStatusDisplayText(string status)
    {
        return status switch
        {
            "Pending" => "Pending Coordinator Review",
            "ApprovedByCoordinator" => "Approved by Coordinator",
            "Approved" => "Approved",
            "Rejected" => "Rejected",
            _ => status
        };
    }

    public string GetStatusColor(string status)
    {
        return status switch
        {
            "Pending" => "warning",
            "ApprovedByCoordinator" => "info",
            "Approved" => "success",
            "Rejected" => "danger",
            _ => "secondary"
        };
    }
}
